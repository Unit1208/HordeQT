# Todo

- [ ] Handle save/load multiple users
- [x] Handle Job Queueing
- [x] Gallery View
  - [Artbot's image view](https://tinybots.net/artbot/images) is called a *Masonry* Layout
- [ ] Model Download
- [x] Queued items view
- [x] User Info
- [x] Persistent Storage of settings
- [ ] About Page
- [x] Toggle for Shared images
- [x] Handle Max jobs, get user concurrency for max
- [ ] Evict Jobs from status after some time
- [x] Cache models, esp. from GH as it's larger and less likely to change
- [-] [QPixmap doesn't support displaying WEBPs](https://doc.qt.io/qtforpython-6/PySide6/QtGui/QPixmap.html#reading-and-writing-image-files), need to convert them before displaying them.
- [x] Allow the user to control the saved format of images after conversion. (Horde always(?) uses WEBP)
- [x] Save generation info into metadata
- [x] Save open tab on close
- [x] Toast on image created
- [x] Button to open locally saved data folder
- [x] Multiple Images (e.g. for loop on addjob)
  - [x] Prompt Matrices
- [x] Conversion from NAI prompt formatting
- [ ] DeepDanbooru integration
  - [ ] Insert Danbooru or similar url, get formatted result
- [ ] Get prompt from metadata (DnD interface)
- [x] Preset box for sizing
- [x] Reset to defaults button
- [x] Undo reset button
- [ ] Prompt/Config History
- [ ] Preset styles (load from repo?)
- [x] Figure out why closing takes so long
- [ ] Figure out why opening takes so long
- [ ] Reload button for user details
- [x] Preview kudos cost
  - [ ] Debug thread issue - it hangs every time a parameter is changed
- [ ] Toggle for done jobs
- [x] Why isn't the scrollbar working on the Masonry layout?
- [ ] Handle resizing
- [x] Actually decent logging - logging and coloredlogs. See verboselogs by the same author as coloredlogs
- [ ] Rescan directory in order to load images that weren't properly saved
- [ ] Error handling
  - [ ] Errored/Censored job state + handling
    - [ ] NSFW
    - [ ] CSAM 
    - [ ] LoRA/TI
```
lora, ti ---->  download_failed, baseline_mismatch
censorship ----> csam, nsfw
source_image, source_mask, extra_source_images ---->  parse_failed
batch_index ----> see_ref
```
- [x] Add a toggle for metadata?
- [ ] Why isn't the gallery working on certain machines?
- [x] Delete button on images
- [x] When saving/Loading current state, trim off model worker count and match by that when loading.
- [x] Use actual rate limit values returned by API calls instead of tracking it manually
- [ ] Use retry-after header
- [x] Disable table editing
- [ ] Double click table entry to jump to location in gallery and open popup
  - [See this](https://stackoverflow.com/questions/4324005/how-to-detect-doubleclick-in-qtableview)
- [ ] Allow sorting queued table by creation time or filter by a certain metric
  - [See pythonguis.com](https://www.pythonguis.com/tutorials/pyqt6-qtableview-modelviews-numpy-pandas/)  
- [ ] Sort options on gallery.
- [ ] Move loading images to load_thread
- [x] Resize images to fit screen on popup
- [ ] LoRAs/TIs
  - [ ] Search result pages
  - [ ] Persist selected LoRAs
  - [ ] Don't allow duplicate LoRAs
- [ ] Warning when trying to use a Pony model incorrectly.
  - [ ] "" for Flux
- [ ] Paginate images (25-50-100)?
- [~] Refactor code into more managable chunks.
- [x] Get appveyor working
  - [x] Use build.py instead of appveyor.yml.
  - [-] Why is MacOS taking so long to start?  
    Known issue on Appveyor's side, nothing I can do about it.
- [ ] Fix Flux
  - [x] Allow for custom models that aren't in the official list
  - [x] Don't freak out when a model has parenthesis in the name.
  - [x] Hires-fix toggle
  - [x] Karras toggle
- [x] Save unknown models to saved data, don't remind again.
- [x] Autosave every ~60s  
- [ ] Add errored jobs to a signal on API thread, then connect to a warning on the app
- [ ] Allow toggle for slow/extra slow workers
- [x] Upscale combobox
- [ ] Cancel button on in-progress images
- [x] Add "open in native viewer" to image popup
- [x] Horde stats page
- [ ] Local stats page
- [ ] Proper horde batching
- [ ] img2img
- [ ] Shared key creation
- [ ] Kudos transfer
- [x] More caching, esp. when using Civit API
- [x] Briefcase (silently) doesn't include folders in .gitignore, *but only on windows*. Remove gen from .gitignore, then add it back when building?
- [x] "Clear cache" button
- [ ] Implement and use a "find good popup size" function, based on the screen size?
- [?] **Intermittent segfaults?**
- [ ] Test:
  - [ ] Fresh setup, no API key, no saved data
  - [ ] Setup with anon key
  - [ ] Setup with no key
- [ ] Use CBOR instead of JSON?
  - How does this work with jsonpickle?
